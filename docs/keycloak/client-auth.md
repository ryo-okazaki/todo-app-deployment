## 1. Client authentication（クライアント認証）
### ON（Confidential）
```
クライアントシークレットを使って認証する必要がある
```

**特徴:**
- クライアントシークレット（パスワードのようなもの）が必要
- サーバーサイドアプリケーション向け
- シークレットを安全に保管できる環境

**使用例:**
- バックエンドサーバー（Node.js、Spring Bootなど）
- 管理者用ダッシュボード
- サーバー間通信

### OFF（Public）
```
クライアントシークレット不要、誰でもアクセス可能
```

**特徴:**
- シークレットなしで動作
- ブラウザやモバイルアプリなど、コードが見える環境向け
- PKCEなどの追加セキュリティ対策が推奨される

**使用例:**
- SPAアプリ（React、Vue.jsなど）
- モバイルアプリ（iOS、Android）
- デスクトップアプリ

## 2. Authorization（認可）

### ON
```
細かいアクセス権限制御を有効化
```

**機能:**
- リソース、スコープ、ポリシーベースの権限管理
- 「誰が」「何を」「どの条件で」アクセスできるかを詳細に設定
- Keycloakの高度な認可機能を使用

**使用例:**
- 複雑な権限要件があるAPI
- リソースごとに異なるアクセス制御が必要な場合
- ロールだけでは表現できない権限管理

### OFF
```
基本的な認証のみ
```

**特徴:**
- シンプルなロールベースのアクセス制御のみ
- 大半のアプリケーションはこれで十分

## 3. Authentication flow（認証フロー）

### Standard flow（標準フロー）- 最も一般的 ✓

**仕組み:**
1. ユーザーをKeycloakのログイン画面にリダイレクト
2. ログイン成功後、認可コードを取得
3. 認可コードをアクセストークンと交換

**使用例:**
- Webアプリケーション（サーバーサイド）
- SPAアプリ（PKCE併用）

**セキュリティ:** ⭐⭐⭐⭐⭐ 最も安全
```
ユーザー → Keycloak（ログイン） → アプリ（認可コード） 
→ アプリサーバー（トークン交換） → アクセストークン取得
```

### Direct access grants（直接アクセス許可）

**仕組み:**
- アプリが直接ユーザー名とパスワードを受け取る
- Keycloakに直接送信してトークンを取得
- **Keycloakのログイン画面を使わない**

**使用例:**
- モバイルアプリのネイティブログイン画面
- CLIツール
- レガシーアプリケーション

**セキュリティ:** ⭐⭐ 非推奨（避けるべき）
```
ユーザー → アプリ（ID/PW入力） → Keycloak → アクセストークン
```

**問題点:**
- アプリがパスワードを扱う（漏洩リスク）
- MFAなどの高度な認証が使えない

### Implicit flow（暗黙的フロー）

**仕組み:**
- 認可コードなしで直接トークンを取得
- URLフラグメントでトークンが返される

**使用例:**
- 昔のSPAアプリ

**セキュリティ:** ⭐ **非推奨・使用禁止**
```
ユーザー → Keycloak（ログイン） → アプリ（直接トークン）
```

**問題点:**
- トークンがブラウザ履歴に残る可能性
- リフレッシュトークンが使えない
- 現在はPKCE付きStandard flowを使うべき

### Service accounts roles（サービスアカウント）

**仕組み:**
- クライアント自体がユーザーのように認証
- ユーザーの代わりにクライアントが主体

**使用例:**
- バッチ処理
- サーバー間通信
- 定期実行ジョブ
- マイクロサービス間の認証

**セキュリティ:** ⭐⭐⭐⭐ 適切に使えば安全
```
サービスA → Keycloak（クライアントID/シークレット） 
→ アクセストークン → サービスB
```

**特徴:**
- ユーザーログイン不要
- クライアント自身の権限で動作

### OAuth 2.0 Device Authorization Grant

**仕組み:**
1. デバイスがコードを表示
2. ユーザーが別のデバイス（スマホなど）でコードを入力
3. 認証完了後、元のデバイスがトークン取得

**使用例:**
- スマートTV
- IoTデバイス
- ゲーム機
- プリンター

**セキュリティ:** ⭐⭐⭐⭐ 入力困難なデバイス向け
```
TV画面: "コード: ABCD-1234" 
→ スマホでhttps://example.com/activate にアクセス
→ コード入力 → ログイン → TV側でトークン取得
```

### OIDC CIBA Grant（Client Initiated Backchannel Authentication）

**仕組み:**
- ユーザーが別のデバイスで認証
- プッシュ通知などで認証リクエスト
- ブラウザを使わない認証

**使用例:**
- 銀行のモバイル承認
- 企業の多要素認証
- セキュリティが重要な取引

**セキュリティ:** ⭐⭐⭐⭐⭐ 高セキュリティ環境向け
```
ATM → Keycloakに認証リクエスト 
→ ユーザーのスマホにプッシュ通知 
→ スマホで承認 → ATM側で認証完了